#------------------------------------------------------------------------------
# @file Makefile
# @author charlesj
# @date 2015-01-22 16:21:36.669294
# @brief Makefile for mixed language (Fortran90, CUDA) compilation
# 
# Makefile for mixed language (Fortran90, CUDA) compilation
# 
# This file was generated by Kppa: http://www.paratools.com/Kppa
#------------------------------------------------------------------------------


FC = gfortran
NVCC = nvcc
LD = $(FC)

CUDA_HOME = /usr/local/cuda

ARCH_FLAGS = -arch sm_30
OPT_FLAGS = -O3
WARN_FLAGS = -Wall
PREC_FLAGS = -fdefault-real-8 -fdefault-double-8

# Uncomment this line to get more information about your CUDA device
#CUDA_CPPFLAGS = -DSHOW_CUDA_DEVICE_PROPERTIES=1

CPPFLAGS = $(CUDA_CPPFLAGS)
FFLAGS = $(OPT_FLAGS) $(WARN_FLAGS) $(PREC_FLAGS)
CXXFLAGS = $(OPT_FLAGS) $(ARCH_FLAGS)
LDFLAGS = $(OPT_FLAGS) -L$(CUDA_HOME)/lib64 -L$(CUDA_HOME)/lib
LIBS = -lm -lcudart

OBJ = kppa_CUDA_integrate.o \
      kppa_CUDA_jacobian.o \
      kppa_CUDA_main.o \
      kppa_CUDA_parameters.o \
      kppa_CUDA_cu_integrate.o \
      kppa_CUDA_rosenbrock.o \
      kppa_CUDA_blas.o \
      kppa_CUDA_rates.o \
      kppa_CUDA_function.o \
      kppa_CUDA_decomp.o \
      kppa_CUDA_solve.o \
      kppa_CUDA_initialize.o \
      kppa_CUDA_driver_parameters.o \
      kppa_CUDA_monitor.o


EXE = kppa_CUDA.exe

all: $(EXE)

$(EXE):  $(OBJ)
	$(LD) -o $(EXE) $(LDFLAGS) $(OBJ) $(LIBS)



kppa_CUDA_integrate.o: kppa_CUDA_integrate.f90 \
        kppa_CUDA_parameters.mod \
        kppa_CUDA_cu_integrate.o \
        kppa_CUDA_rosenbrock.o
	$(FC) -c $(FFLAGS) -o kppa_CUDA_integrate.o kppa_CUDA_integrate.f90

kppa_CUDA_jacobian.o: kppa_CUDA_jacobian.cu \
        kppa_CUDA_cu_parameters.h \
        kppa_CUDA_sparse.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_jacobian.o kppa_CUDA_jacobian.cu

kppa_CUDA_main.o: kppa_CUDA_main.f90 \
        kppa_CUDA_parameters.mod \
        kppa_CUDA_integrate.o \
        kppa_CUDA_initialize.o \
        kppa_CUDA_driver_parameters.mod \
        kppa_CUDA_monitor.o
	$(FC) -c $(FFLAGS) -o kppa_CUDA_main.o kppa_CUDA_main.f90

kppa_CUDA_parameters.mod: kppa_CUDA_parameters.f90
	$(FC) -c $(FFLAGS) -o kppa_CUDA_parameters.o kppa_CUDA_parameters.f90

kppa_CUDA_cu_integrate.o: kppa_CUDA_cu_integrate.cu \
        kppa_CUDA_cu_parameters.h \
        kppa_CUDA_sparse.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_cu_integrate.o kppa_CUDA_cu_integrate.cu

kppa_CUDA_rosenbrock.o: kppa_CUDA_rosenbrock.cu \
        kppa_CUDA_cu_parameters.h \
        kppa_CUDA_blas.o \
        kppa_CUDA_rates.o \
        kppa_CUDA_function.o \
        kppa_CUDA_decomp.o \
        kppa_CUDA_solve.o \
        kppa_CUDA_jacobian.o \
        kppa_CUDA_sparse.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_rosenbrock.o kppa_CUDA_rosenbrock.cu

kppa_CUDA_blas.o: kppa_CUDA_blas.cu \
        kppa_CUDA_cu_parameters.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_blas.o kppa_CUDA_blas.cu

kppa_CUDA_rates.o: kppa_CUDA_rates.cu \
        kppa_CUDA_cu_parameters.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_rates.o kppa_CUDA_rates.cu

kppa_CUDA_function.o: kppa_CUDA_function.cu \
        kppa_CUDA_cu_parameters.h \
        kppa_CUDA_sparse.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_function.o kppa_CUDA_function.cu

kppa_CUDA_decomp.o: kppa_CUDA_decomp.cu \
        kppa_CUDA_cu_parameters.h \
        kppa_CUDA_sparse.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_decomp.o kppa_CUDA_decomp.cu

kppa_CUDA_solve.o: kppa_CUDA_solve.cu \
        kppa_CUDA_cu_parameters.h \
        kppa_CUDA_sparse.h
	$(NVCC) -c $(CXXFLAGS) $(CPPFLAGS) -o kppa_CUDA_solve.o kppa_CUDA_solve.cu

kppa_CUDA_initialize.o: kppa_CUDA_initialize.f90 \
        kppa_CUDA_parameters.mod
	$(FC) -c $(FFLAGS) -o kppa_CUDA_initialize.o kppa_CUDA_initialize.f90

kppa_CUDA_driver_parameters.mod: kppa_CUDA_driver_parameters.f90
	$(FC) -c $(FFLAGS) -o kppa_CUDA_driver_parameters.o kppa_CUDA_driver_parameters.f90

kppa_CUDA_monitor.o: kppa_CUDA_monitor.f90 \
        kppa_CUDA_parameters.mod
	$(FC) -c $(FFLAGS) -o kppa_CUDA_monitor.o kppa_CUDA_monitor.f90


clean:
	rm -f kppa_CUDA_integrate.o kppa_CUDA_jacobian.o kppa_CUDA_main.o kppa_CUDA_parameters.o kppa_CUDA_cu_integrate.o kppa_CUDA_rosenbrock.o kppa_CUDA_blas.o kppa_CUDA_rates.o kppa_CUDA_function.o kppa_CUDA_decomp.o kppa_CUDA_solve.o kppa_CUDA_initialize.o kppa_CUDA_driver_parameters.o kppa_CUDA_monitor.o
	rm -f kppa_CUDA_jacobian.h kppa_CUDA_parameters.mod kppa_CUDA_cu_integrate.h kppa_CUDA_cu_parameters.h kppa_CUDA_sparse.h kppa_CUDA_rosenbrock.h kppa_CUDA_blas.h kppa_CUDA_rates.h kppa_CUDA_function.h kppa_CUDA_decomp.h kppa_CUDA_solve.h kppa_CUDA_initialize.mod kppa_CUDA_driver_parameters.mod kppa_CUDA_monitor.mod
	rm -f kppa_CUDA.exe
	
destroy: clean
	rm -f kppa_CUDA_integrate.f90 kppa_CUDA_jacobian.cu kppa_CUDA_main.f90 kppa_CUDA_parameters.f90 kppa_CUDA_cu_integrate.cu kppa_CUDA_rosenbrock.cu kppa_CUDA_blas.cu kppa_CUDA_rates.cu kppa_CUDA_function.cu kppa_CUDA_decomp.cu kppa_CUDA_solve.cu kppa_CUDA_initialize.f90 kppa_CUDA_driver_parameters.f90 kppa_CUDA_monitor.f90 Makefile


#----------------------------- END Makefile END -------------------------------